<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        color: gray;
        text-align: center;
    }

    .cell {
        width: 3em;
        height: 3em;
        display: inline-block;
        border: 2px solid #eeeeee;
        border-radius: .25em;
    }

    .type1 {
        background-color: royalblue;
    }

    .type2 {
        background-color: tomato;
    }

    .type3 {
        border: 2px solid tomato;
    }
</style>

<body>
    <h2>Block Game</h2>
    <h3>Place all blocks in the hole</h3>
    <p>Use arrow keys to play</p>
    <hr />
    <br />
    <div></div>
    <script>
        // 1 is the player
        // 2 is the block
        // 3 is the hole
        A = [
            [0, 0, 0, 3, 0],
            [0, 2, 0, 0, 0],
            [0, 0, 1, 0, 0],
            [0, 0, 2, 0, 0],
            [0, 0, 0, 0, 0]
        ]

        d = document.querySelector("div")

        // To draw the game board at first
        // And redraw it later in the game
        const drawGameBoard = () => {
            d.innerHTML = ""
            A.forEach((row) => {
                div = document.createElement("div")
                div.className = "row"
                row.forEach((c) => {
                    cell = document.createElement("div")
                    cell.className = "cell type" + c
                    div.appendChild(cell)
                })
                d.appendChild(div)
            });
        }

        const findGameBlock = (typeNo) => {
            founded = []
            for (r in A) {
                for (c in A[r]) {
                    if (A[r][c] == typeNo)
                        founded.push({ "row": parseInt(r), "col": parseInt(c) })
                }
            }
            return founded
        }

        const checkWinning = () => {
            if (findGameBlock(2).length == 0)
                alert("You won the game")
        }

        // mx: -1 or +1 -> amount of movement over X axis
        // my: -1 or +1 -> amount of movement over Y axis
        const moveToNewPlace = (c, my, mx) => {
            // c: current Place
            // n: new Place
            let n = { row: c.row + my, col: c.col + mx }
            console.log("c", c, "n", n)

            //------------------------------------------------
            if (n.row < A.length && n.row >= 0) {
                if (n.col < A[n.row].length && n.col >= 0) {
                    if (A[n.row][n.col] == 2) {
                        //"Recursive" function call
                        // Recursive programming is an important concept
                        // To move [Red(Tomato)] blocks with [Blue[Player]]
                        moveToNewPlace(n, my, mx)
                    }
                    if (A[n.row][n.col] != 3) {
                        A[n.row][n.col] = A[c.row][c.col]
                    } else {
                        if (A[c.row][c.col] == 1) {
                            alert("Game Over")
                        }
                    }

                    A[c.row][c.col] = 0
                }
            }
            drawGameBoard()
            checkWinning()
        }

        document.addEventListener("keydown", (e) => {
            key = e.key
            place = findGameBlock(1)[0]
            if (key == "ArrowUp")
                moveToNewPlace(place, -1, 0)
            else if (key == "ArrowRight")
                moveToNewPlace(place, 0, +1)
            else if (key == "ArrowDown")
                moveToNewPlace(place, +1, 0)
            else if (key == "ArrowLeft")
                moveToNewPlace(place, 0, -1)
        })

        drawGameBoard()
    </script>
</body>

</html>